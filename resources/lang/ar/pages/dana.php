<?php

return [

    'hint' => 'RSA (التحقق باستخدام المفتاح العام لـ DANA).',

    'summary' => <<<'TEXT'
تستخدم DANA مخطط توقيع **غير متماثل**: يتم توقيع الطلبات بمفتاح خاص، ويقوم المتكاملون بالتحقق منها باستخدام **المفتاح العام الرسمي لـ DANA**. عمليًا، تقوم باستخراج التوقيع من ترويسة الـ webhook (على سبيل المثال `X-SIGNATURE`)، ثم تفك ترميزه من base64، وبعد ذلك تتحقق من جسم طلب HTTP الخام مقابل ذلك التوقيع باستخدام RSA-2048 مع SHA-256. لا ينبغي اعتبار الـ payload أصيلاً إلا إذا أعادت عملية التحقق نتيجة إيجابية. إذا فشل التحقق — أو كان التوقيع/الترويسة مفقودًا — فقم بالرد برمز غير 2xx وأوقف المعالجة.

ولأن webhooks قد يُعاد إرسالها أو قد تصل بترتيب غير متوقع، صمّم المعالج ليكون idempotent: خزّن معرّف حدث فريدًا وامنع تكرار المعالجة؛ تحقّق من حداثة أي timestamp/nonce لتقليل هجمات إعادة الإرسال (replay)؛ واعتبر جميع الحقول غير موثوقة حتى بعد نجاح التحقق من التوقيع. تجنّب إعادة تسلسل JSON قبل التحقق؛ قم بعمل الهاش على البايتات نفسها التي وصلت عبر الشبكة. أبقِ الأسرار والمفاتيح الخاصة خارج السجلات؛ وإذا اضطررت للتسجيل، فاكتفِ بتشخيصات عالية المستوى (نتيجة التحقق، هاش للجسم، معرّف الحدث) واحمِ تلك السجلات أثناء التخزين.

للفِرَق، انشر دليل تشغيل مختصرًا يوضح: كيفية تحميل أو تدوير المفتاح العام لـ DANA، وكيفية التحقق في كل لغة/بيئة تشغيل تستخدمها، وقواعد string-to-sign الدقيقة لتكاملك، وما الذي يُعد فشلًا دائمًا مقابل فشلًا عابرًا. وازن ذلك بسياسة retry/backoff قوية، وطوابير عمل محدودة، وفحوصات صحة (health checks)، وتنبيهات عند فشل التحقق. والنتيجة هي مستهلك Webhook آمن تحت الضغط، متين أمام إعادة المحاولة، ومتوافق مع التحقق التشفيري الذي تتطلبه DANA تصميمًا.
TEXT
    ,

    // dari view DANA
    'docs' => 'https://dashboard.dana.id/api-docs-v2/guide/authentication',

    'signature_notes' => [
        'فك ترميز base64 للقيمة من ترويسة `X-SIGNATURE`.',
        'تحقق من RSA-2048 + SHA-256 على جسم HTTP الخام تمامًا باستخدام المفتاح العام الرسمي لـ DANA؛ اقبل فقط إذا أعادت عملية التحقق نتيجة إيجابية.',
        'ارفض أي webhook بتوقيع مفقود/غير صالح أو payload غير سليم؛ لا تثق بأي بيانات قبل نجاح التحقق.',
    ],

    'example_payload' => [
        'id'       => 'evt_' . now()->timestamp,
        'type'     => 'payment.paid',
        'provider' => 'dana',
        'data'     => [
            'transaction_id' => 'DANA-001',
            'amount'         => 25000,
            'currency'       => 'IDR',
            'status'         => 'SUCCESS',
        ],
        'sent_at'  => now()->toIso8601String(),
    ],

    'endpoints' => [
        [
            'method' => 'POST',
            'path'   => '/api/payments',
            'desc'   => __('pages.create_payment'),
        ],
        [
            'method' => 'GET',
            'path'   => '/api/payments/{id}',
            'desc'   => __('pages.get_payment'),
        ],
        [
            'method' => 'POST',
            'path'   => '/api/webhooks/dana',
            'desc'   => __('pages.receive_webhook'),
        ],
    ],
];
