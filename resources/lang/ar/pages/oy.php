<?php

return [

    'hint' => 'توقيع كولباك خاص بالمزوّد.',

    'summary' => <<<'TEXT'
تُعدّ كولباكات OY! جزءًا من نهج أمني أوسع يعتمد على مفاتيح API المسجّلة وقوائم السماح لعناوين IP المصدر (allowlisting) لطلبات الشركاء. كما توفّر OY! ميزة Authorization Callback التي تتيح لك التحكم في الكولباكات والموافقة عليها قبل أن تصل إلى نظامك، ما يضيف بوابة صريحة لمنع تغييرات حالة غير مقصودة. عمليًا، ينبغي أن تتعامل مع كل كولباك وارد على أنه غير موثوق حتى يتم التحقق منه، وأن تفرض حداثة الطلب (نافذة timestamp/nonce)، وأن تجعل المستهلك idempotent كي تبقى عمليات إعادة الإرسال وترتيب الأحداث غير المتسق آمنة.

وبما أن المزوّدين يختلفون في طريقة توقيع الكولباكات، يعرض محاكينا أساسًا مُحصّنًا باستخدام ترويسة HMAC (مثل `X-Callback-Signature`) محسوبة فوق جسم الطلب الخام تمامًا بمفتاح سرّي مشترك. يوضّح ذلك نفس المبادئ التي ستستخدمها في الإنتاج: تجزئة بايتات الجسم الخام (دون إعادة تسلسل)، مقارنة بزمن ثابت (constant-time)، ونوافذ إعادة تشغيل قصيرة. اجمع ذلك مع مخزن dedup صغير وإقرارات 2xx سريعة للحفاظ على منطق إعادة المحاولة لدى المزوّد سليمًا مع تفادي الآثار الجانبية المكررة.

تشغيليًا، احتفظ بسجل تدقيق (وقت الاستلام، نتيجة التحقق، تجزئة الجسم—not المفتاح السرّي)، ودوّر الأسرار بأمان، وراقب معدلات فشل التحقق. وإن كنت تعتمد على قوائم السماح، فتذكّر أنها قد تتغيّر؛ يجب أن يبقى الفحص التشفيري (أو بوابة التفويض الصريحة من OY!) مرساة الثقة الأساسية. اجعل نقطة النهاية ضيقة وواضحة وموثقة جيدًا كي تتمكن الخدمات الأخرى وأعضاء الفريق من إعادة استخدامها بثقة.
TEXT
    ,

    // dari view OY
    'docs' => 'https://docs.oyindonesia.com/',

    'signature_notes' => [
        'استخدم نهج أمان OY!: مفتاح API مسجّل + قوائم سماح IP المصدر لطلبات الشركاء.',
        'استفد من Authorization Callback (لوحة التحكم) للموافقة على الكولباكات قبل وصولها إلى نظامك.',
        'في هذا المحاكي، تحقق من `X-Callback-Signature = HMAC-SHA256(raw_body, secret)` كنموذج لأفضل الممارسات؛ طبّق مقارنة constant-time وفحوصات الحداثة.',
        'اجعل المعالجة idempotent وأعد 2xx بسرعة للحفاظ على صحة عمليات إعادة المحاولة لدى المزوّد.',
    ],

    'example_payload' => [
        'id'       => 'evt_' . now()->timestamp,
        'type'     => 'payment.completed',
        'provider' => 'oy',
        'data'     => [
            'partner_trx_id' => 'PRT-001',
            'amount'         => 25000,
            'currency'       => 'IDR',
            'status'         => 'COMPLETED',
        ],
        'sent_at'  => now()->toIso8601String(),
    ],

    'endpoints' => [
        [
            'method' => 'POST',
            'path'   => '/api/payments',
            'desc'   => __('pages.create_payment'),
        ],
        [
            'method' => 'GET',
            'path'   => '/api/payments/{id}',
            'desc'   => __('pages.get_payment'),
        ],
        [
            'method' => 'POST',
            'path'   => '/api/webhooks/oy',
            'desc'   => __('pages.receive_webhook'),
        ],
    ],
];
