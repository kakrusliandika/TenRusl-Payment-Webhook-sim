<?php

return [

    'hint' => 'Подпись токеном callback.',

    'summary' => <<<'TEXT'
Xendit «подписывает» webhook-события аккаунтным токеном, который передаётся в заголовке `x-callback-token`. В вашей интеграции необходимо сравнивать этот заголовок с токеном, полученным в панели Xendit, и отклонять любые запросы с отсутствующим или несовпадающим токеном. Некоторые webhook-продукты также передают `webhook-id`, который можно сохранять, чтобы предотвращать повторную обработку при ретраях.

В эксплуатации делайте проверку самым первым шагом, сохраняйте неизменяемую (immutable) запись события, быстро подтверждайте 2xx и переносите тяжёлую работу в очереди. Обеспечьте идемпотентность через `webhook-id` (или свой ключ) и применяйте узкое временное окно, если есть timestamp-метаданные. Задокументируйте полный путь (проверка, дедупликация, ретраи и коды ошибок), чтобы команда и сервисы одинаково интегрировались во всех окружениях.
TEXT
    ,

    // dari view Xendit
    'docs' => 'https://docs.xendit.co/docs/handling-webhooks',

    'signature_notes' => [
        'Сравните `x-callback-token` с вашим уникальным токеном из панели Xendit; при несовпадении отклоняйте.',
        'Используйте `webhook-id` (если присутствует) для дедупликации; считайте проверку жёстким gate до парсинга JSON.',
        'Быстро возвращайте 2xx и откладывайте тяжёлую работу; логируйте минимум диагностики без раскрытия секретов.',
    ],

    'example_payload' => [
        'id'       => 'evt_xnd_' . now()->timestamp,
        'event'    => 'invoice.paid',
        'data'     => [
            'id'     => 'inv_001',
            'status' => 'PAID',
        ],
        'provider' => 'xendit',
        'sent_at'  => now()->toIso8601String(),
    ],

    'endpoints' => [
        [
            'method' => 'POST',
            'path'   => '/api/payments',
            'desc'   => __('pages.create_payment'),
        ],
        [
            'method' => 'GET',
            'path'   => '/api/payments/{id}',
            'desc'   => __('pages.get_payment'),
        ],
        [
            'method' => 'POST',
            'path'   => '/api/webhooks/xendit',
            'desc'   => __('pages.receive_webhook'),
        ],
    ],
];
