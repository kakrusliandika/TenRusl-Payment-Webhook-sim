<?php

return [

    'hint' => 'RSA (проверка с использованием публичного ключа DANA).',

    'summary' => <<<'TEXT'
DANA использует **асимметричную** схему подписи: запросы подписываются приватным ключом, а интеграторы проверяют их с помощью официального **публичного ключа DANA**. На практике вы берёте подпись из заголовка webhook (например, `X-SIGNATURE`), декодируете её из base64, а затем проверяете «сырой» HTTP-body запроса на соответствие подписи с помощью RSA-2048 и SHA-256. Только при положительном результате проверки payload можно считать подлинным. Если проверка не проходит — или подпись/заголовок отсутствуют — ответьте кодом non-2xx и прекратите обработку.

Поскольку webhooks могут ретраиться или приходить не по порядку, проектируйте обработчик как идемпотентный: сохраняйте уникальный идентификатор события и «срезайте» дубликаты; проверяйте timestamp/nonce на актуальность, чтобы снизить риск replay; и считайте все поля недоверенными до успешной проверки подписи. Не пересериализуйте JSON перед проверкой; хешируйте/проверяйте ровно те байты, которые пришли «по проводу». Не пишите секреты и приватные ключи в логи; если логирование необходимо, фиксируйте только диагностику верхнего уровня (результат проверки, хэш body, ID события) и защищайте такие логи при хранении.

Для команды подготовьте короткий runbook: как загружать или ротировать публичный ключ DANA, как выполнять проверку в каждом используемом языке/рантайме, какие точные правила string-to-sign действуют в вашей интеграции и что считать постоянной ошибкой, а что временной. Дополните это надёжной retry/backoff-политикой, ограниченными очередями работ, health-check’ами и алертами на ошибки проверки. В итоге вы получите webhook-consumer, который безопасен под нагрузкой, устойчив к повторам и соответствует криптографической верификации, требуемой DANA по дизайну.
TEXT
    ,

    // dari view DANA
    'docs' => 'https://dashboard.dana.id/api-docs-v2/guide/authentication',

    'signature_notes' => [
        'Декодируйте значение из заголовка `X-SIGNATURE` из base64.',
        'Проверьте RSA-2048 + SHA-256 по точному raw HTTP-body, используя официальный публичный ключ DANA; принимайте только при положительном результате проверки.',
        'Отклоняйте любой webhook с отсутствующей/некорректной подписью или некорректным payload; никогда не доверяйте данным до успешной проверки.',
    ],

    'example_payload' => [
        'id'       => 'evt_' . now()->timestamp,
        'type'     => 'payment.paid',
        'provider' => 'dana',
        'data'     => [
            'transaction_id' => 'DANA-001',
            'amount'         => 25000,
            'currency'       => 'IDR',
            'status'         => 'SUCCESS',
        ],
        'sent_at'  => now()->toIso8601String(),
    ],

    'endpoints' => [
        [
            'method' => 'POST',
            'path'   => '/api/payments',
            'desc'   => __('pages.create_payment'),
        ],
        [
            'method' => 'GET',
            'path'   => '/api/payments/{id}',
            'desc'   => __('pages.get_payment'),
        ],
        [
            'method' => 'POST',
            'path'   => '/api/webhooks/dana',
            'desc'   => __('pages.receive_webhook'),
        ],
    ],
];
