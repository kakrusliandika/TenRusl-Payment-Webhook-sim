<?php

return [

    'hint' => 'Подпись колбэка, специфичная для провайдера.',

    'summary' => <<<'TEXT'
Колбэки OY! — часть более широкой модели безопасности, основанной на зарегистрированных API-ключах и allowlisting IP-адресов источника для партнёрских запросов. OY! также предлагает функцию Authorization Callback, которая позволяет контролировать и утверждать колбэки до того, как они попадут в вашу систему, добавляя явный «шлюз» для предотвращения нежелательных изменений состояния. На практике всё равно следует считать любой входящий колбэк недоверенным до проверки, применять freshness (окно timestamp/nonce) и делать обработчик идемпотентным, чтобы ретраи и доставка вне порядка оставались безопасными.

Поскольку публичные провайдеры по-разному подписывают колбэки, наш симулятор демонстрирует усиленную базовую схему с HMAC-заголовком (например, `X-Callback-Signature`), вычисляемым по точному raw request body с общим секретом. Это иллюстрирует те же принципы, что и в продакшене: хэширование сырых байт (без ре-сериализации), constant-time сравнение и короткие окна защиты от replay. Дополните это небольшим хранилищем дедупликации и быстрым 2xx-подтверждением, чтобы логика повторов провайдера оставалась здоровой и не возникали дублирующие побочные эффекты.

С операционной точки зрения ведите аудит-трейл (время получения, результат проверки, хэш тела — не секрет), безопасно ротируйте секреты и отслеживайте долю ошибок проверки. Если вы полагаетесь на allowlist, помните, что он может меняться; криптографическая проверка (или явный шлюз авторизации OY) должна оставаться основным якорем доверия. Держите endpoint узким, предсказуемым и хорошо документированным, чтобы другие сервисы и коллеги могли уверенно переиспользовать его.
TEXT
    ,

    // dari view OY
    'docs' => 'https://docs.oyindonesia.com/',

    'signature_notes' => [
        'Используйте модель безопасности OY!: зарегистрированный API-ключ + allowlisting IP-адреса источника для партнёрских запросов.',
        'Используйте Authorization Callback (в дашборде), чтобы утверждать колбэки до попадания в вашу систему.',
        'В этом симуляторе проверяйте `X-Callback-Signature = HMAC-SHA256(raw_body, secret)` как best-practice модель; применяйте constant-time сравнение и проверки freshness.',
        'Делайте обработку идемпотентной и быстро возвращайте 2xx, чтобы ретраи провайдера работали корректно.',
    ],

    'example_payload' => [
        'id'       => 'evt_' . now()->timestamp,
        'type'     => 'payment.completed',
        'provider' => 'oy',
        'data'     => [
            'partner_trx_id' => 'PRT-001',
            'amount'         => 25000,
            'currency'       => 'IDR',
            'status'         => 'COMPLETED',
        ],
        'sent_at'  => now()->toIso8601String(),
    ],

    'endpoints' => [
        [
            'method' => 'POST',
            'path'   => '/api/payments',
            'desc'   => __('pages.create_payment'),
        ],
        [
            'method' => 'GET',
            'path'   => '/api/payments/{id}',
            'desc'   => __('pages.get_payment'),
        ],
        [
            'method' => 'POST',
            'path'   => '/api/webhooks/oy',
            'desc'   => __('pages.receive_webhook'),
        ],
    ],
];
