<?php

return [

    'hint' => 'Уведомления, специфичные для продукта.',

    'summary' => <<<'TEXT'
Payoneer Checkout доставляет асинхронные уведомления (webhooks) на контролируемый вами endpoint, чтобы ваша система могла безопасно сверять состояние платежа вне браузера пользователя. Платформа позволяет задать выделенный notification URL и выбрать стиль доставки, который лучше подходит вашему стеку — POST (рекомендуется) или GET, с JSON либо form-encoded параметрами. Поскольку точный набор параметров и схемы подписи/аутентификации зависят от продукта, относитесь к уведомлениям Payoneer как к интеграционной поверхности: документируйте заголовки/поля, по которым определяется событие, добавляйте анти-replay метаданные там, где они доступны, и проверяйте подлинность до изменения состояния.

С точки зрения эксплуатации начните с узкого идемпотентного обработчика, который сохраняет неизменяемую запись события и быстро отвечает 2xx. Тяжёлую бизнес-логику держите в фоновых воркерах, чтобы избежать «шторма» повторных доставок. Применяйте ключи дедупликации и задавайте окно свежести для timestamp/nonce (если доступны), чтобы защититься от replay и доставки вне порядка. Если нужно больше уверенности, добавьте в notification URL токен от провайдера (или свой случайный секрет) и валидируйте его на сервере. Наконец, опубликуйте для команды runbook с описанием endpoints, форматов, кодов ошибок и точных шагов верификации для вашей продуктовой вариации Payoneer — и версионируйте его вместе с кодом.
TEXT
    ,

    // Dari view Payoneer
    'docs' => 'https://checkoutdocs.payoneer.com/docs/create-notification-endpoints',

    'signature_notes' => [
        'Поднимите выделенный endpoint для уведомлений (POST рекомендуется); принимайте JSON или form-данные.',
        'Проверяйте подлинность согласно документации вашей продуктовой вариации (токен или поля подписи); при несовпадении отклоняйте.',
        'При наличии timestamp/nonce применяйте окно свежести и делайте обработку идемпотентной (сохраняйте dedup-ключ).',
        'Быстро ACK (2xx) и выносите тяжёлую работу в фоновые задачи; ведите аудит без логирования секретов.',
    ],

    'example_payload' => [
        'event' => 'checkout.transaction.completed',
        'provider' => 'payoneer',
        'data' => [
            'orderId' => 'PO-001',
            'amount' => 25000,
            'currency' => 'IDR',
            'status' => 'COMPLETED',
        ],
        'sent_at' => now()->toIso8601String(),
    ],

    'endpoints' => [
        [
            'method' => 'POST',
            'path' => '/api/payments',
            'desc' => __('pages.create_payment'),
        ],
        [
            'method' => 'GET',
            'path' => '/api/payments/{id}',
            'desc' => __('pages.get_payment'),
        ],
        [
            'method' => 'POST',
            'path' => '/api/webhooks/payoneer',
            'desc' => __('pages.receive_webhook'),
        ],
    ],
];
