###############################################################################
# TenRusl Payment Webhook Simulator — PRODUCTION Environment (MINIMAL & REAL)
# - Isi semua secrets lewat secret manager (Render Secrets / Vault / etc.)
# - Untuk platform seperti Render, lebih simpel pakai DB_URL dari managed Postgres.
#
# Catatan penting PRODUCTION:
# - Scheduler harus dipicu (cron) setiap menit: `php artisan schedule:run`
# - Queue worker harus selalu hidup (process monitor) jika memakai QUEUE_CONNECTION != sync
###############################################################################

APP_NAME="TenRusl Payment Webhook Sim"
APP_ENV=production
APP_KEY=base64:PUT_YOUR_APP_KEY_HERE
APP_DEBUG=false
APP_URL=https://your-domain.com

APP_TIMEZONE=UTC
APP_LOCALE=en
APP_FALLBACK_LOCALE=en

###############################################################################
# Logging (container-friendly)
###############################################################################
LOG_CHANNEL=stack
LOG_STACK=stderr
LOG_LEVEL=info
LOG_DEPRECATIONS_CHANNEL=null

###############################################################################
# OPTIONAL: Links (dipakai config/app.php jika ada)
###############################################################################
APP_REPO_URL=https://github.com/your-org/your-repo
APP_STATUS_URL=https://status.your-domain.com

###############################################################################
# TRUSTED PROXY (di belakang LB / reverse proxy)
###############################################################################
TRUSTED_PROXIES=*
# TRUSTED_PROXIES=10.0.0.0/8,172.16.0.0/12

###############################################################################
# RATE LIMITING (opsional; dipakai RouteServiceProvider)
###############################################################################
TENRUSL_RATE_WEB_PER_MINUTE=240
TENRUSL_RATE_API_PER_SECOND=5
TENRUSL_RATE_API_PER_MINUTE=120
TENRUSL_RATE_WEBHOOKS_PER_SECOND=10
TENRUSL_RATE_WEBHOOKS_PER_MINUTE=600

# Alias untuk config/tenrusl.php (jika dipakai)
TENRUSL_WEBHOOK_RATE_LIMIT_PER_MINUTE=600
TENRUSL_WEBHOOK_RATE_LIMIT_KEY_BY=ip_provider

###############################################################################
# DATABASE (PROD) — RECOMMENDED: use DB_URL (platform-managed)
###############################################################################
DB_CONNECTION=pgsql

# Prefer this (works well for Render managed Postgres):
DB_URL=postgresql://USER:PASSWORD@HOST:5432/tenrusl_webhook?sslmode=require

# Fallback (jika tidak pakai DB_URL):
DB_HOST=
DB_PORT=5432
DB_DATABASE=tenrusl_webhook
DB_USERNAME=
DB_PASSWORD=

###############################################################################
# CACHE / SESSION / QUEUE (PROD = TERDISTRIBUSI)
###############################################################################
CACHE_STORE=redis

SESSION_DRIVER=redis
SESSION_LIFETIME=120
SESSION_ENCRYPT=true
SESSION_DOMAIN=your-domain.com
SESSION_SECURE_COOKIE=true
SESSION_SAME_SITE=lax

# Queue default (production-friendly)
QUEUE_CONNECTION=redis
QUEUE_AFTER_COMMIT=true
QUEUE_FAILED_DRIVER=database-uuids

###############################################################################
# REDIS (PROD)
###############################################################################
REDIS_CLIENT=phpredis

# Prefer URL if available (optional):
REDIS_URL=redis://HOST:6379

# Fallback:
REDIS_HOST=
REDIS_PORT=6379
REDIS_PASSWORD=

###############################################################################
# QUEUE — Redis tuning (optional, but recommended)
###############################################################################
# Koneksi redis yang dipakai khusus untuk queue (lihat config/database.php -> redis.connections)
REDIS_QUEUE_CONNECTION=queue
REDIS_QUEUE=default
REDIS_QUEUE_RETRY_AFTER=90

# block_for (detik) mengurangi busy-loop saat queue kosong (lebih hemat CPU).
# - default di config/queue.php memakai REDIS_QUEUE_BLOCK_FOR_DEFAULT=5
# - set REDIS_QUEUE_BLOCK_FOR=null untuk non-blocking
REDIS_QUEUE_BLOCK_FOR_DEFAULT=5
# REDIS_QUEUE_BLOCK_FOR=

###############################################################################
# WORKER — runtime knobs (untuk start.sh / supervisor / platform worker)
###############################################################################
# Catatan:
# - `queue:work` adalah proses long-lived. Saat deploy, lakukan restart worker
#   agar code baru ter-load (mis. `php artisan queue:restart`).
WORKER_SLEEP=1
WORKER_TRIES=3
WORKER_TIMEOUT=90
WORKER_QUEUE=default

###############################################################################
# CORS (PROD) — set domain frontend admin yang valid
###############################################################################
CORS_ALLOWED_ORIGINS=https://admin.your-domain.com
CORS_SUPPORTS_CREDENTIALS=false
CORS_MAX_AGE=600

###############################################################################
# TenRusl — Providers Allowlist (WAJIB di PROD)
# Deny-by-default: kalau kosong, provider harus dianggap tidak diizinkan.
###############################################################################
TENRUSL_PROVIDERS_ALLOWLIST=mock,xendit,midtrans,stripe,paypal

# Contoh full catalog (opsional):
# TENRUSL_PROVIDERS_ALLOWLIST=mock,xendit,midtrans,stripe,paypal,paddle,lemonsqueezy,airwallex,tripay,doku,dana,oy,payoneer,skrill,amazon_bwp

###############################################################################
# TenRusl — Admin keys (dipakai controller) — WAJIB untuk endpoint admin
###############################################################################
TENRUSL_ADMIN_KEY=PUT_SECRET_HERE

# Demo key (non-production / staging). Disarankan KOSONGKAN di production:
TENRUSL_ADMIN_DEMO_KEY=

# Nama header admin key (default: X-Admin-Key)
TENRUSL_ADMIN_HEADER=X-Admin-Key

# Optional hardening:
# Jika ingin memaksa DEMO benar-benar mati di production:
TENRUSL_ADMIN_ACCEPT_DEMO_IN_PROD=false

###############################################################################
# TenRusl — Runtime knobs (dipakai config/tenrusl.php + scheduler)
###############################################################################
TENRUSL_PROCESSING_LEASE_SECONDS=30
TENRUSL_RETRY_MIN_LEASE_MS=3000

TENRUSL_MAX_RETRY_ATTEMPTS=8
TENRUSL_RETRY_BASE_MS=500
TENRUSL_RETRY_CAP_MS=60000

TENRUSL_SCHEDULER_PROVIDER=
TENRUSL_SCHEDULER_BACKOFF_MODE=decorrelated
TENRUSL_SCHEDULER_LIMIT=500

# Lebih scalable: scheduler hanya enqueue, worker yang proses
TENRUSL_SCHEDULER_QUEUE=true

# Scheduler singleton + lock
TENRUSL_SCHEDULER_SINGLETON=true
TENRUSL_SCHEDULER_LOCK_MINUTES=10

# Idempotency
TENRUSL_IDEMPOTENCY_TTL=21600
TENRUSL_IDEMPOTENCY_STORAGE=redis
TENRUSL_IDEMPOTENCY_TTL_SECONDS=21600
TENRUSL_IDEMPOTENCY_LOCK_SECONDS=30

# Dedup webhook retention knob (future maintenance)
TENRUSL_WEBHOOK_DEDUP_TTL_SECONDS=86400

# Signature timestamp leeway (second)
TENRUSL_SIG_TS_LEEWAY=300
TENRUSL_SIG_TS_LEEWAY_SECONDS=300

###############################################################################
# WEBHOOK RECEIVER — SAFETY KNOBS
###############################################################################
TENRUSL_WEBHOOK_MAX_PAYLOAD_BYTES=5242880
TENRUSL_WEBHOOK_QUEUE=default

###############################################################################
# CORRELATION ID (opsional; request tracing)
###############################################################################
TENRUSL_CORRELATION_ID_HEADER=X-Request-ID
TENRUSL_CORRELATION_ID_GENERATE=true
TENRUSL_CORRELATION_ID_INCLUDE_IN_RESPONSE=true

###############################################################################
# MAIL (opsional)
###############################################################################
MAIL_MAILER=smtp
MAIL_HOST=
MAIL_PORT=587
MAIL_USERNAME=
MAIL_PASSWORD=
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="noreply@your-domain.com"
MAIL_FROM_NAME="${APP_NAME}"

###############################################################################
# Provider secrets — isi yang dipakai saja (TENRUSL_* disarankan)
###############################################################################
TENRUSL_MOCK_SECRET=

TENRUSL_XENDIT_CALLBACK_TOKEN=
TENRUSL_MIDTRANS_SERVER_KEY=
TENRUSL_STRIPE_WEBHOOK_SECRET=

TENRUSL_PAYPAL_ENV=live
TENRUSL_PAYPAL_WEBHOOK_ID=
TENRUSL_PAYPAL_CLIENT_ID=
TENRUSL_PAYPAL_CLIENT_SECRET=

TENRUSL_PADDLE_SIGNING_SECRET=
TENRUSL_PADDLE_PUBLIC_KEY=

TENRUSL_LEMONSQUEEZY_WEBHOOK_SECRET=
TENRUSL_AIRWALLEX_WEBHOOK_SECRET=
TENRUSL_TRIPAY_PRIVATE_KEY=

TENRUSL_DOKU_CLIENT_ID=
TENRUSL_DOKU_SECRET_KEY=
TENRUSL_DOKU_REQUEST_TARGET=/

TENRUSL_DANA_PUBLIC_KEY=

TENRUSL_OY_CALLBACK_SECRET=
TENRUSL_OY_IP_WHITELIST=

TENRUSL_PAYONEER_SHARED_SECRET=
TENRUSL_PAYONEER_MERCHANT_ID=

TENRUSL_SKRILL_MERCHANT_ID=
TENRUSL_SKRILL_EMAIL=
TENRUSL_SKRILL_MD5_SECRET=

TENRUSL_AMZN_BWP_PUBLIC_KEY=

###############################################################################
# Legacy (DEPRECATED) — isi hanya jika masih dibutuhkan oleh code lama
###############################################################################
# STRIPE_WEBHOOK_SECRET=
# PAYPAL_ENV=live
# PAYPAL_WEBHOOK_ID=
# PAYPAL_CLIENT_ID=
# PAYPAL_CLIENT_SECRET=
# XENDIT_CALLBACK_TOKEN=
# MIDTRANS_SERVER_KEY=
